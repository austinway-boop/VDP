<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Recorder</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app">
        <h1>Audio Recorder</h1>
        
        <div class="controls">
            <button id="recordBtn" class="record-btn">Record 10s</button>
            <button id="uploadBtn" class="upload-btn">Upload File</button>
            <button id="emotionBtn" class="emotion-btn" style="display:none;">üé≠ Analyze Emotion</button>
            <button id="liveSpeechBtn" class="live-speech-btn" onclick="audioRecorder.analyzeBrowserSpeech()" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px;">
                üé§ Live Speech Analysis
            </button>
            <input type="file" id="fileInput" accept="audio/*">
        </div>

        <div class="recording-status" id="recordingStatus">
            Recording... <span id="countdown">10</span>s remaining
        </div>

        <div class="status-message" id="statusMessage"></div>

        <div class="playback-controls" id="playbackControls">
            <button id="playBtn" class="play-btn">Play</button>
            <span id="currentTime">0:00</span> / <span id="totalTime">0:00</span>
        </div>

        <div class="waveform-section" id="waveformSection">
            <div class="arousal-container">
                <canvas id="arousal"></canvas>
                <div class="arousal-info" id="arousalInfo">Avg Arousal: 0%</div>
                <div class="arousal-bar-container">
                    <div class="arousal-bar-fill" id="arousalBarFill"></div>
                </div>
            </div>
            <div class="metrics-container" id="metricsContainer">
                <div class="metric-container loudness-container">
                    <canvas id="loudnessCanvas" class="metric-canvas"></canvas>
                    <div class="metric-info" id="loudnessInfo">Loudness: 0 dB</div>
                    <div class="metric-bar-container">
                        <div class="metric-bar-fill" id="loudnessBarFill"></div>
                    </div>
                </div>
                <div class="metric-container pitch-container">
                    <canvas id="pitchCanvas" class="metric-canvas"></canvas>
                    <div class="metric-info" id="pitchInfo">Pitch: 0 Hz</div>
                    <div class="metric-bar-container">
                        <div class="metric-bar-fill" id="pitchBarFill"></div>
                    </div>
                </div>
                <div class="metric-container pace-container">
                    <canvas id="paceCanvas" class="metric-canvas"></canvas>
                    <div class="metric-info" id="paceInfo">Pace: 0 WPM</div>
                    <div class="metric-bar-container">
                        <div class="metric-bar-fill" id="paceBarFill"></div>
                    </div>
                </div>
            </div>
            <div class="waveform-container">
                <canvas id="waveform"></canvas>
                <div class="scrubber" id="scrubber"></div>
            </div>
            <div class="speech-analysis" id="speechAnalysis">
                <div class="speech-boxes" id="speechBoxes"></div>
                <div class="speech-stats">
                    <div>Speech Activity</div>
                    <div class="speaking-percentage" id="speakingPercentage">Speaking: 0%</div>
                </div>
            </div>
            <div class="audio-info" id="audioInfo">
                Duration: <span id="duration">0:00</span>
            </div>
        </div>
        
        <!-- Emotion Analysis Results -->
        <div class="emotion-analysis" id="emotionAnalysis" style="display:none;">
            <h3>üé≠ Emotion Analysis Results</h3>
            
            <!-- Training Status Alert (only shown when needed) -->
            <div class="training-alert" id="trainingAlert" style="display:none;">
                <div class="alert-content">
                    <span class="alert-icon">‚ö†Ô∏è</span>
                    <span class="alert-text">Low confidence detected - saved for training</span>
                    <a href="http://localhost:5002" target="_blank" class="review-link">Review Now</a>
                </div>
            </div>
            
            <div class="emotion-transcription" id="emotionTranscription">
                <strong>Transcription:</strong> <span id="transcriptionText">No speech detected</span>
                <div class="confidence-info" id="confidenceInfo" style="display:none;">
                    <span class="confidence-label">Confidence:</span>
                    <span class="confidence-value" id="confidenceValue">0%</span>
                    <div class="confidence-bar" id="confidenceBar">
                        <div class="confidence-fill" id="confidenceFill"></div>
                    </div>
                </div>
            </div>
            <div class="word-analysis" id="wordAnalysis">
                <strong>Word-by-Word Analysis:</strong>
                <div class="word-breakdown" id="wordBreakdown">
                    <!-- Individual words with color coding will appear here -->
                </div>
                <div class="word-legend">
                    <span class="legend-item joy">üòä Joy</span>
                    <span class="legend-item trust">ü§ù Trust</span>
                    <span class="legend-item anticipation">ü§î Anticipation</span>
                    <span class="legend-item surprise">üòÆ Surprise</span>
                    <span class="legend-item anger">üò† Anger</span>
                    <span class="legend-item fear">üò∞ Fear</span>
                    <span class="legend-item sadness">üò¢ Sadness</span>
                    <span class="legend-item disgust">ü§¢ Disgust</span>
                    <span class="legend-item neutral">üòê Neutral/Unknown</span>
                    <span class="legend-item laughter">üòÑ Laughter Boost</span>
                </div>
            </div>
            <div class="emotion-results" id="emotionResults">
                <div class="primary-emotion">
                    <span id="emotionIcon">üòê</span>
                    <span id="emotionName">Neutral</span>
                    <span id="emotionConfidence">0%</span>
                </div>
                <div class="emotion-details" id="emotionDetails">
                    <!-- Emotion bars will be populated by JavaScript -->
                </div>
                <div class="vad-scores">
                    <div class="vad-score">
                        <label>Valence:</label>
                        <span id="valenceScore">0.50</span>
                    </div>
                    <div class="vad-score">
                        <label>Arousal:</label>
                        <span id="arousalScore">0.50</span>
                    </div>
                    <div class="vad-score">
                        <label>Dominance:</label>
                        <span id="dominanceScore">0.50</span>
                    </div>
                </div>
                <div class="sentiment-analysis">
                    <label>Sentiment:</label>
                    <span id="sentimentPolarity">Neutral</span>
                    (<span id="sentimentStrength">50%</span>)
                </div>
            </div>
            
            <!-- Laughter Analysis Section -->
            <div class="laughter-analysis" id="laughterAnalysis" style="display:none;">
                <h4>üòÑ Laughter Detection</h4>
                <div class="laughter-summary" id="laughterSummary">
                    No laughter detected
                </div>
                
                <!-- Laughter Timeline Graph -->
                <div class="laughter-graph-container" id="laughterGraphContainer" style="display:none;">
                    <h5>üìä Laughter Timeline</h5>
                    <div class="graph-wrapper">
                        <canvas id="laughterGraph" width="600" height="120"></canvas>
                        <div class="graph-labels">
                            <span class="time-label">0s</span>
                            <span class="time-label" style="float: right;" id="maxTimeLabel">10s</span>
                        </div>
                    </div>
                </div>
                
                <div class="laughter-timeline" id="laughterTimeline">
                    <!-- Laughter segments will be shown here -->
                </div>
                <div class="laughter-influence" id="laughterInfluence" style="display:none;">
                    <!-- Laughter influence on emotions will be shown here -->
                </div>
            </div>
            
            <!-- Music Detection Section -->
            <div class="music-analysis" id="musicAnalysis" style="display:none;">
                <h4>üéµ Background Music Detection</h4>
                <div class="music-summary" id="musicSummary">
                    No music detected
                </div>
                
                <!-- Music Timeline Graph -->
                <div class="music-graph-container" id="musicGraphContainer" style="display:none;">
                    <h5>üìä Music Timeline</h5>
                    <div class="graph-wrapper">
                        <canvas id="musicGraph" width="600" height="120"></canvas>
                        <div class="graph-labels">
                            <span class="time-label">0s</span>
                            <span class="time-label" style="float: right;" id="musicMaxTimeLabel">10s</span>
                        </div>
                    </div>
                </div>
                
                <div class="music-timeline" id="musicTimeline">
                    <!-- Music segments will be shown here -->
                </div>
                <div class="identified-songs" id="identifiedSongs" style="display:none;">
                    <!-- Identified songs will be shown here -->
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>